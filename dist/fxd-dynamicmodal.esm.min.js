function t(t,o,e={}){t&&t.dispatchEvent(new CustomEvent(o,{detail:e,bubbles:!0}))}function o(t,o={}){const e=function(t={}){const o=new URLSearchParams;return Object.entries(t).forEach(([t,e])=>{null!=e&&(Array.isArray(e)?e.forEach(e=>{null!=e&&o.append(t,String(e))}):o.set(t,String(e)))}),o}(o),s=e.toString();return s?t+(t.includes("?")?"&":"?")+s:t}function e(t,o,e=null){if(!t)return;if(t.innerHTML="","undefined"!=typeof Node&&o instanceof Node){const e=o.cloneNode(!0);return void t.appendChild(e)}const s=null==o?"":String(o);t.innerHTML="function"==typeof e?e(s):s}function s(t,o){const s=function(t){if(!t||"md"===t)return"";const o=String(t).trim();return o?o.startsWith("modal-")?o:o.startsWith("fullscreen")||["sm","lg","xl","xxl"].includes(o)?`modal-${o}`:o:""}(o.size);var n,i;t.dialog.className="modal-dialog modal-dialog-centered",s&&t.dialog.classList.add(s),n=t.dialog,i=o.extraModalClass,n&&i&&i.split(" ").forEach(t=>{t&&n.classList.add(t)}),t.title.textContent=o.title??"",t.footer.style.display=o.showFooter?"flex":"none",t.closeBtn.style.display=o.showCloseBtn?"inline-block":"none",o.footerHtml&&e(t.footer,o.footerHtml,o.sanitize)}class n{constructor(o={}){this.options={...n.defaults,...o},this.state={open:!1,loading:!1,requestId:0},this._ensureBootstrap(),this._mount(),this._bindBootstrapEvents(),t(this.modalEl,"fxd:init",{modal:this}),this.options.onInit?.(this)}_ensureBootstrap(){const t=this.options.bootstrap||("undefined"!=typeof window?window.bootstrap:null);if(!t||!t.Modal)throw new Error("FxdDynamicModal requires Bootstrap 5 Modal to be available.");this.bootstrap=t}_mount(){const t=document.getElementById(this.options.modalId);if(t){if(this.modalEl=t,this.dialogEl=t.querySelector(".modal-dialog"),this.titleEl=t.querySelector('[data-fxd-role="title"]')||t.querySelector(".modal-title"),this.bodyEl=t.querySelector('[data-fxd-role="content"]')||t.querySelector(".modal-body"),this.footerEl=t.querySelector('[data-fxd-role="footer"]')||t.querySelector(".modal-footer"),this.closeBtnEl=t.querySelector('[data-fxd-role="close"]')||t.querySelector(".btn-close"),!(this.dialogEl&&this.titleEl&&this.bodyEl&&this.footerEl&&this.closeBtnEl))throw new Error("FxdDynamicModal found an existing modal but required elements are missing.")}else{const t=function(t,o){const s=document.createElement("div");s.className="modal fade",s.id=t,s.tabIndex=-1,s.setAttribute("aria-hidden","true");const n=`${t}-title`,i=`${t}-content`;s.setAttribute("aria-labelledby",n),s.setAttribute("aria-describedby",i);const l=document.createElement("div");l.className="modal-dialog modal-dialog-centered";const a=document.createElement("div");a.className="modal-content";const d=document.createElement("div");d.className="modal-header";const r=document.createElement("h5");r.className="modal-title",r.id=n,r.dataset.fxdRole="title";const h=document.createElement("button");h.type="button",h.className="btn-close",h.setAttribute("data-bs-dismiss","modal"),h.setAttribute("aria-label","Close"),h.dataset.fxdRole="close",d.appendChild(r),d.appendChild(h);const c=document.createElement("div");c.className="modal-body",c.id=i,c.dataset.fxdRole="content";const u=document.createElement("div");u.className="modal-footer",u.dataset.fxdRole="footer";const m=document.createElement("button");return m.type="button",m.className="btn btn-secondary",m.textContent=o.footerButtonText||"OK",m.setAttribute("data-bs-dismiss","modal"),u.appendChild(m),a.appendChild(d),a.appendChild(c),a.appendChild(u),l.appendChild(a),s.appendChild(l),e(c,o.loadingHtml||""),{modal:s,dialog:l,title:r,body:c,footer:u,closeBtn:h}}(this.options.modalId,this.options);document.body.appendChild(t.modal),this.modalEl=t.modal,this.dialogEl=t.dialog,this.titleEl=t.title,this.bodyEl=t.body,this.footerEl=t.footer,this.closeBtnEl=t.closeBtn}}_bindBootstrapEvents(){this._onShown=()=>{this.state.open=!0,t(this.modalEl,"fxd:open",{modal:this}),this.options.onOpen?.(this)},this._onHidden=()=>{this.state.open=!1,t(this.modalEl,"fxd:close",{modal:this}),this.options.onClose?.(this)},this.modalEl.addEventListener("shown.bs.modal",this._onShown),this.modalEl.addEventListener("hidden.bs.modal",this._onHidden)}_ensureInstance(t){const o=!!t.bgClose||"static",e=Boolean(t.bgClose);this.modalInstance&&this.bsOptions?.backdrop===o&&this.bsOptions?.keyboard===e||(this.modalInstance?.dispose(),this.modalInstance=new this.bootstrap.Modal(this.modalEl,{backdrop:o,keyboard:e}),this.bsOptions={backdrop:o,keyboard:e})}_startLoading(o){this.state.loading=!0,t(this.modalEl,"fxd:loadstart",{modal:this,source:o}),this.options.onLoadStart?.(this,o)}_endLoading(o){this.state.loading=!1,t(this.modalEl,"fxd:loadend",{modal:this,source:o}),this.options.onLoadEnd?.(this,o)}_handleError(o,s){this.state.loading=!1,t(this.modalEl,"fxd:error",{modal:this,source:s,error:o}),this.options.onError?.(o,this,s),this.options.errorHtml&&e(this.bodyEl,this.options.errorHtml,this.options.sanitize)}setTitle(t){this.titleEl.textContent=t??""}setContent(t){e(this.bodyEl,t,this.options.sanitize)}setFooter(t){this.footerEl&&e(this.footerEl,t,this.options.sanitize)}async open(t=null,n={},i={}){const l={...this.options,...i};if(s({dialog:this.dialogEl,title:this.titleEl,footer:this.footerEl,closeBtn:this.closeBtnEl},l),l.loadingHtml&&e(this.bodyEl,l.loadingHtml,l.sanitize),this._ensureInstance(l),this.modalInstance.show(),!t)return null;if("string"==typeof t&&t.trim().startsWith("#")){const o=document.querySelector(t.trim());return o?(this._startLoading(t),e(this.bodyEl,o.innerHTML,l.sanitize),this._endLoading(t),null):(this._handleError(new Error("Element not found"),t),null)}if(a=t,"undefined"!=typeof Element&&(a instanceof Element||a instanceof HTMLElement))return this._startLoading(t),e(this.bodyEl,t,l.sanitize),this._endLoading(t),null;var a;if("string"==typeof t){const s=o(t,n),i=++this.state.requestId;this.abortController&&this.abortController.abort(),this.abortController=new AbortController,this._startLoading(s);try{const t=l.fetch||fetch,o=await async function(t,o,e){const s=await o(t,{signal:e});if(!s.ok){const t=new Error(`Request failed with status ${s.status}`);throw t.status=s.status,t.response=s,t}return s.text()}(s,t,this.abortController.signal);if(i!==this.state.requestId)return null;e(this.bodyEl,o,l.sanitize),l.initTooltips&&(this._disposeTooltips(),this._tooltips=function(t,o={},e=null){if(!t)return;if("undefined"==typeof window)return;const s=e||window.bootstrap;if(!s||!s.Tooltip)return;return Array.from(t.querySelectorAll('[data-bs-toggle="tooltip"]')).map(t=>new s.Tooltip(t,o))}(this.bodyEl,l.tooltipOptions||{},this.bootstrap)||[]),this._endLoading(s)}catch(t){if("AbortError"===t?.name)return null;this._handleError(t,s)}return null}return this._handleError(new Error("Unsupported source type"),t),null}close(){this.modalInstance?.hide()}_disposeTooltips(){this._tooltips&&0!==this._tooltips.length&&(this._tooltips.forEach(t=>t?.dispose?.()),this._tooltips=[])}destroy(){this.abortController?.abort(),this._disposeTooltips(),this.modalInstance?.dispose(),this.modalEl.removeEventListener("shown.bs.modal",this._onShown),this.modalEl.removeEventListener("hidden.bs.modal",this._onHidden),t(this.modalEl,"fxd:destroy",{modal:this}),this.options.onDestroy?.(this),this.modalEl.remove()}getState(){return{...this.state}}}n.defaults={modalId:"fxdDynamicModal",title:"Modal Title",size:"md",showFooter:!0,bgClose:!0,showCloseBtn:!0,extraModalClass:"",footerHtml:null,footerButtonText:"OK",loadingHtml:'<div class="d-flex justify-content-center align-items-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div>',errorHtml:'<p class="text-danger mb-0">Error loading content</p>',sanitize:null,fetch:null,initTooltips:!0,tooltipOptions:{html:!0},bootstrap:null,onInit:null,onOpen:null,onClose:null,onLoadStart:null,onLoadEnd:null,onError:null,onDestroy:null};export{n as FxdDynamicModal};
//# sourceMappingURL=fxd-dynamicmodal.esm.min.js.map
