{"version":3,"file":"fxd-dynamicmodal.umd.min.js","sources":["../src/core/events.js","../src/core/utils.js","../src/core/render.js","../src/core/FxdDynamicModal.js","../src/core/loader.js"],"sourcesContent":["export function dispatchEvent(el, name, detail = {}) {\n  if (!el) return;\n  el.dispatchEvent(new CustomEvent(name, { detail, bubbles: true }));\n}","export function toSearchParams(params = {}) {\n  const search = new URLSearchParams();\n  Object.entries(params).forEach(([key, value]) => {\n    if (value === undefined || value === null) return;\n    if (Array.isArray(value)) {\n      value.forEach((item) => {\n        if (item === undefined || item === null) return;\n        search.append(key, String(item));\n      });\n      return;\n    }\n    search.set(key, String(value));\n  });\n  return search;\n}\n\nexport function buildUrl(url, params = {}) {\n  const search = toSearchParams(params);\n  const query = search.toString();\n  if (!query) return url;\n  return url + (url.includes('?') ? '&' : '?') + query;\n}\n\nexport function setContent(container, content, sanitizer = null) {\n  if (!container) return;\n  container.innerHTML = '';\n\n  if (typeof Node !== 'undefined' && content instanceof Node) {\n    const node = content.cloneNode(true);\n    container.appendChild(node);\n    return;\n  }\n\n  const html = content == null ? '' : String(content);\n  container.innerHTML = typeof sanitizer === 'function' ? sanitizer(html) : html;\n}\n\nexport function isDomElement(value) {\n  if (typeof Element === 'undefined') return false;\n  return value instanceof Element || value instanceof HTMLElement;\n}\n\nexport function initTooltips(root, options = {}, bootstrapOverride = null) {\n  if (!root) return;\n  if (typeof window === 'undefined') return;\n  const bs = bootstrapOverride || window.bootstrap;\n  if (!bs || !bs.Tooltip) return;\n\n  const triggers = Array.from(root.querySelectorAll('[data-bs-toggle=\"tooltip\"]'));\n  return triggers.map((el) => {\n    // eslint-disable-next-line no-new\n    return new bs.Tooltip(el, options);\n  });\n}\n\nexport function resolveSizeClass(size) {\n  if (!size || size === 'md') return '';\n  const normalized = String(size).trim();\n  if (!normalized) return '';\n  if (normalized.startsWith('modal-')) return normalized;\n  if (normalized.startsWith('fullscreen')) return `modal-${normalized}`;\n  if (['sm', 'lg', 'xl', 'xxl'].includes(normalized)) return `modal-${normalized}`;\n  return normalized;\n}\n\nexport function addClassTokens(el, classString) {\n  if (!el || !classString) return;\n  classString.split(' ').forEach((token) => {\n    if (token) el.classList.add(token);\n  });\n}\n","import { addClassTokens, resolveSizeClass, setContent } from './utils.js';\n\nexport function createModalTemplate(modalId, options) {\n  const modal = document.createElement('div');\n  modal.className = 'modal fade';\n  modal.id = modalId;\n  modal.tabIndex = -1;\n  modal.setAttribute('aria-hidden', 'true');\n\n  const titleId = `${modalId}-title`;\n  const contentId = `${modalId}-content`;\n\n  modal.setAttribute('aria-labelledby', titleId);\n  modal.setAttribute('aria-describedby', contentId);\n\n  const dialog = document.createElement('div');\n  dialog.className = 'modal-dialog modal-dialog-centered';\n\n  const content = document.createElement('div');\n  content.className = 'modal-content';\n\n  const header = document.createElement('div');\n  header.className = 'modal-header';\n\n  const title = document.createElement('h5');\n  title.className = 'modal-title';\n  title.id = titleId;\n  title.dataset.fxdRole = 'title';\n\n  const closeBtn = document.createElement('button');\n  closeBtn.type = 'button';\n  closeBtn.className = 'btn-close';\n  closeBtn.setAttribute('data-bs-dismiss', 'modal');\n  closeBtn.setAttribute('aria-label', 'Close');\n  closeBtn.dataset.fxdRole = 'close';\n\n  header.appendChild(title);\n  header.appendChild(closeBtn);\n\n  const body = document.createElement('div');\n  body.className = 'modal-body';\n  body.id = contentId;\n  body.dataset.fxdRole = 'content';\n\n  const footer = document.createElement('div');\n  footer.className = 'modal-footer';\n  footer.dataset.fxdRole = 'footer';\n\n  const okBtn = document.createElement('button');\n  okBtn.type = 'button';\n  okBtn.className = 'btn btn-secondary';\n  okBtn.textContent = options.footerButtonText || 'OK';\n  okBtn.setAttribute('data-bs-dismiss', 'modal');\n  footer.appendChild(okBtn);\n\n  content.appendChild(header);\n  content.appendChild(body);\n  content.appendChild(footer);\n  dialog.appendChild(content);\n  modal.appendChild(dialog);\n\n  setContent(body, options.loadingHtml || '');\n\n  return {\n    modal,\n    dialog,\n    title,\n    body,\n    footer,\n    closeBtn,\n  };\n}\n\nexport function applyModalSettings(ui, settings) {\n  const sizeClass = resolveSizeClass(settings.size);\n  ui.dialog.className = 'modal-dialog modal-dialog-centered';\n  if (sizeClass) ui.dialog.classList.add(sizeClass);\n  addClassTokens(ui.dialog, settings.extraModalClass);\n\n  ui.title.textContent = settings.title ?? '';\n\n  ui.footer.style.display = settings.showFooter ? 'flex' : 'none';\n  ui.closeBtn.style.display = settings.showCloseBtn ? 'inline-block' : 'none';\n\n  if (settings.footerHtml) {\n    setContent(ui.footer, settings.footerHtml, settings.sanitize);\n  }\n}","import { dispatchEvent } from './events.js';\nimport { buildUrl, initTooltips, isDomElement, setContent } from './utils.js';\nimport { loadContent } from './loader.js';\nimport { applyModalSettings, createModalTemplate } from './render.js';\n\nexport class FxdDynamicModal {\n  constructor(options = {}) {\n    this.options = { ...FxdDynamicModal.defaults, ...options };\n    this.state = {\n      open: false,\n      loading: false,\n      requestId: 0,\n    };\n\n    this._ensureBootstrap();\n    this._mount();\n    this._bindBootstrapEvents();\n\n    dispatchEvent(this.modalEl, 'fxd:init', { modal: this });\n    this.options.onInit?.(this);\n  }\n\n  _ensureBootstrap() {\n    const bs = this.options.bootstrap || (typeof window !== 'undefined' ? window.bootstrap : null);\n    if (!bs || !bs.Modal) {\n      throw new Error('FxdDynamicModal requires Bootstrap 5 Modal to be available.');\n    }\n    this.bootstrap = bs;\n  }\n\n  _mount() {\n    const existing = document.getElementById(this.options.modalId);\n\n    if (existing) {\n      this.modalEl = existing;\n      this.dialogEl = existing.querySelector('.modal-dialog');\n      this.titleEl = existing.querySelector('[data-fxd-role=\"title\"]') || existing.querySelector('.modal-title');\n      this.bodyEl = existing.querySelector('[data-fxd-role=\"content\"]') || existing.querySelector('.modal-body');\n      this.footerEl = existing.querySelector('[data-fxd-role=\"footer\"]') || existing.querySelector('.modal-footer');\n      this.closeBtnEl = existing.querySelector('[data-fxd-role=\"close\"]') || existing.querySelector('.btn-close');\n\n      if (!this.dialogEl || !this.titleEl || !this.bodyEl || !this.footerEl || !this.closeBtnEl) {\n        throw new Error('FxdDynamicModal found an existing modal but required elements are missing.');\n      }\n    } else {\n      const ui = createModalTemplate(this.options.modalId, this.options);\n      document.body.appendChild(ui.modal);\n      this.modalEl = ui.modal;\n      this.dialogEl = ui.dialog;\n      this.titleEl = ui.title;\n      this.bodyEl = ui.body;\n      this.footerEl = ui.footer;\n      this.closeBtnEl = ui.closeBtn;\n    }\n  }\n\n  _bindBootstrapEvents() {\n    this._onShown = () => {\n      this.state.open = true;\n      dispatchEvent(this.modalEl, 'fxd:open', { modal: this });\n      this.options.onOpen?.(this);\n    };\n\n    this._onHidden = () => {\n      this.state.open = false;\n      dispatchEvent(this.modalEl, 'fxd:close', { modal: this });\n      this.options.onClose?.(this);\n    };\n\n    this.modalEl.addEventListener('shown.bs.modal', this._onShown);\n    this.modalEl.addEventListener('hidden.bs.modal', this._onHidden);\n  }\n\n  _ensureInstance(settings) {\n    const backdrop = settings.bgClose ? true : 'static';\n    const keyboard = Boolean(settings.bgClose);\n\n    if (!this.modalInstance || this.bsOptions?.backdrop !== backdrop || this.bsOptions?.keyboard !== keyboard) {\n      this.modalInstance?.dispose();\n      this.modalInstance = new this.bootstrap.Modal(this.modalEl, { backdrop, keyboard });\n      this.bsOptions = { backdrop, keyboard };\n    }\n  }\n\n  _startLoading(source) {\n    this.state.loading = true;\n    dispatchEvent(this.modalEl, 'fxd:loadstart', { modal: this, source });\n    this.options.onLoadStart?.(this, source);\n  }\n\n  _endLoading(source) {\n    this.state.loading = false;\n    dispatchEvent(this.modalEl, 'fxd:loadend', { modal: this, source });\n    this.options.onLoadEnd?.(this, source);\n  }\n\n  _handleError(error, source) {\n    this.state.loading = false;\n    dispatchEvent(this.modalEl, 'fxd:error', { modal: this, source, error });\n    this.options.onError?.(error, this, source);\n    if (this.options.errorHtml) {\n      setContent(this.bodyEl, this.options.errorHtml, this.options.sanitize);\n    }\n  }\n\n  setTitle(title) {\n    this.titleEl.textContent = title ?? '';\n  }\n\n  setContent(content) {\n    setContent(this.bodyEl, content, this.options.sanitize);\n  }\n\n  setFooter(content) {\n    if (!this.footerEl) return;\n    setContent(this.footerEl, content, this.options.sanitize);\n  }\n\n  async open(source = null, params = {}, overrideOptions = {}) {\n    const settings = { ...this.options, ...overrideOptions };\n    const selectorSource = typeof source === 'string' ? source.trim() : '';\n    const isSelectorSource = Boolean(selectorSource && selectorSource.startsWith('#'));\n    const isElementSource = isDomElement(source);\n    const isRemoteSource = typeof source === 'string' && !isSelectorSource;\n\n    applyModalSettings(\n      {\n        dialog: this.dialogEl,\n        title: this.titleEl,\n        footer: this.footerEl,\n        closeBtn: this.closeBtnEl,\n      },\n      settings\n    );\n\n    if (isRemoteSource && settings.loadingHtml) {\n      setContent(this.bodyEl, settings.loadingHtml, settings.sanitize);\n    }\n\n    this._ensureInstance(settings);\n    if (!source) {\n      this.modalInstance.show();\n      return null;\n    }\n\n    if (isSelectorSource) {\n      const el = document.querySelector(selectorSource);\n      if (!el) {\n        this._handleError(new Error('Element not found'), source);\n        this.modalInstance.show();\n        return null;\n      }\n      this._startLoading(source);\n      setContent(this.bodyEl, el.innerHTML, settings.sanitize);\n      this._endLoading(source);\n      this.modalInstance.show();\n      this.modalInstance.handleUpdate?.();\n      return null;\n    }\n\n    if (isElementSource) {\n      this._startLoading(source);\n      setContent(this.bodyEl, source, settings.sanitize);\n      this._endLoading(source);\n      this.modalInstance.show();\n      this.modalInstance.handleUpdate?.();\n      return null;\n    }\n\n    this.modalInstance.show();\n\n    if (isRemoteSource) {\n      const url = buildUrl(source, params);\n      const requestId = ++this.state.requestId;\n      if (this.abortController) this.abortController.abort();\n      this.abortController = new AbortController();\n\n      this._startLoading(url);\n\n      try {\n        const fetchFn = settings.fetch || fetch;\n        const html = await loadContent(url, fetchFn, this.abortController.signal);\n        if (requestId !== this.state.requestId) return null;\n\n        setContent(this.bodyEl, html, settings.sanitize);\n        this.modalInstance.handleUpdate?.();\n        if (settings.initTooltips) {\n          this._disposeTooltips();\n          this._tooltips = initTooltips(this.bodyEl, settings.tooltipOptions || {}, this.bootstrap) || [];\n        }\n        this._endLoading(url);\n      } catch (error) {\n        if (error?.name === 'AbortError') return null;\n        this._handleError(error, url);\n      }\n      return null;\n    }\n\n    this._handleError(new Error('Unsupported source type'), source);\n    return null;\n  }\n\n  showConfirm(confirmOptions = {}) {\n    const options = {\n      ...FxdDynamicModal.confirmDefaults,\n      ...confirmOptions,\n    };\n    const settings = {\n      ...this.options,\n      ...options,\n      showFooter: true,\n      footerHtml: null,\n    };\n\n    this._clearConfirmState();\n\n    applyModalSettings(\n      {\n        dialog: this.dialogEl,\n        title: this.titleEl,\n        footer: this.footerEl,\n        closeBtn: this.closeBtnEl,\n      },\n      settings\n    );\n\n    setContent(this.bodyEl, options.message || '', settings.sanitize);\n\n    this.footerEl.innerHTML = '';\n    const cancelBtn = document.createElement('button');\n    cancelBtn.type = 'button';\n    cancelBtn.className = `btn ${options.cancelVariant}`;\n    cancelBtn.textContent = options.cancelText;\n    cancelBtn.setAttribute('data-bs-dismiss', 'modal');\n    cancelBtn.dataset.fxdRole = 'confirm-cancel';\n\n    const confirmBtn = document.createElement('button');\n    confirmBtn.type = 'button';\n    confirmBtn.className = `btn ${options.confirmVariant}`;\n    confirmBtn.textContent = options.confirmText;\n    confirmBtn.dataset.fxdRole = 'confirm-submit';\n\n    this.footerEl.appendChild(cancelBtn);\n    this.footerEl.appendChild(confirmBtn);\n\n    let completed = false;\n    const onHidden = () => {\n      if (completed) return;\n      completed = true;\n      this._clearConfirmState();\n      options.onCancel?.({ modal: this });\n    };\n\n    const onConfirmClick = async (event) => {\n      event.preventDefault();\n      if (completed) return;\n\n      const originalText = confirmBtn.textContent;\n      confirmBtn.disabled = true;\n      cancelBtn.disabled = true;\n      confirmBtn.textContent = options.confirmLoadingText;\n\n      try {\n        if (options.confirmAction) {\n          await this._executeConfirmAction(options.confirmAction);\n        }\n        options.onConfirm?.({ modal: this });\n        completed = true;\n        this._clearConfirmState();\n        this.close();\n      } catch (error) {\n        options.onError?.(error, { modal: this });\n        confirmBtn.disabled = false;\n        cancelBtn.disabled = false;\n        confirmBtn.textContent = originalText;\n      }\n    };\n\n    confirmBtn.addEventListener('click', onConfirmClick);\n    this.modalEl.addEventListener('hidden.bs.modal', onHidden);\n\n    this._confirmCleanup = () => {\n      confirmBtn.removeEventListener('click', onConfirmClick);\n      this.modalEl.removeEventListener('hidden.bs.modal', onHidden);\n      this._confirmCleanup = null;\n    };\n\n    this._ensureInstance(settings);\n    this.modalInstance.show();\n\n    return this;\n  }\n\n  _clearConfirmState() {\n    this._confirmCleanup?.();\n  }\n\n  async _executeConfirmAction(confirmAction) {\n    const action = {\n      method: 'POST',\n      data: {},\n      async: true,\n      headers: {},\n      ...confirmAction,\n    };\n    const method = String(action.method || 'POST').toUpperCase();\n    const context = { modal: this, action };\n\n    if (!action.url) {\n      throw new Error('confirmAction.url is required.');\n    }\n\n    const beforeResult = action.onBeforeSend?.(context);\n    if (beforeResult === false) {\n      throw new Error('confirmAction cancelled by onBeforeSend.');\n    }\n\n    if (!action.async) {\n      this._submitConfirmForm(action.url, method, action.data);\n      return null;\n    }\n\n    const fetchFn = action.fetch || this.options.fetch || fetch;\n    const isGet = method === 'GET';\n    const headers = { ...action.headers };\n    let url = action.url;\n    let body;\n\n    if (isGet) {\n      url = buildUrl(url, action.data || {});\n    } else {\n      const search = new URLSearchParams();\n      Object.entries(action.data || {}).forEach(([key, value]) => {\n        if (value === undefined || value === null) return;\n        search.append(key, String(value));\n      });\n      body = search.toString();\n      if (!headers['Content-Type']) {\n        headers['Content-Type'] = 'application/x-www-form-urlencoded; charset=UTF-8';\n      }\n    }\n\n    let response;\n    let responseData = null;\n\n    try {\n      response = await fetchFn(url, {\n        method,\n        headers,\n        body,\n      });\n\n      const text = await response.text();\n      try {\n        responseData = JSON.parse(text);\n      } catch {\n        responseData = text;\n      }\n\n      if (!response.ok) {\n        throw new Error(`confirmAction request failed with status ${response.status}.`);\n      }\n\n      action.onSuccess?.(responseData, response, context);\n      return responseData;\n    } catch (error) {\n      action.onError?.(error, response, context);\n      throw error;\n    } finally {\n      action.onComplete?.(context);\n    }\n  }\n\n  _submitConfirmForm(url, method, data = {}) {\n    const form = document.createElement('form');\n    form.method = method;\n    form.action = url;\n    form.style.display = 'none';\n\n    Object.entries(data).forEach(([key, value]) => {\n      if (value === undefined || value === null) return;\n\n      if (Array.isArray(value)) {\n        value.forEach((item) => {\n          if (item === undefined || item === null) return;\n          const input = document.createElement('input');\n          input.type = 'hidden';\n          input.name = key;\n          input.value = String(item);\n          form.appendChild(input);\n        });\n        return;\n      }\n\n      const input = document.createElement('input');\n      input.type = 'hidden';\n      input.name = key;\n      input.value = String(value);\n      form.appendChild(input);\n    });\n\n    document.body.appendChild(form);\n    form.submit();\n    form.remove();\n  }\n\n  close() {\n    this.modalInstance?.hide();\n  }\n\n  _disposeTooltips() {\n    if (!this._tooltips || this._tooltips.length === 0) return;\n    this._tooltips.forEach((tooltip) => tooltip?.dispose?.());\n    this._tooltips = [];\n  }\n\n  destroy() {\n    this.abortController?.abort();\n    this._disposeTooltips();\n    this.modalInstance?.dispose();\n    this.modalEl.removeEventListener('shown.bs.modal', this._onShown);\n    this.modalEl.removeEventListener('hidden.bs.modal', this._onHidden);\n    dispatchEvent(this.modalEl, 'fxd:destroy', { modal: this });\n    this.options.onDestroy?.(this);\n    this.modalEl.remove();\n  }\n\n  getState() {\n    return { ...this.state };\n  }\n}\n\nFxdDynamicModal.defaults = {\n  modalId: 'fxdDynamicModal',\n  title: 'Modal Title',\n  size: 'md',\n  showFooter: true,\n  bgClose: true,\n  showCloseBtn: true,\n  extraModalClass: '',\n  footerHtml: null,\n  footerButtonText: 'OK',\n  loadingHtml: '<div class=\"d-flex justify-content-center align-items-center\">' +\n    '<div class=\"spinner-border\" role=\"status\">' +\n    '<span class=\"visually-hidden\">Loading...</span>' +\n    '</div></div>',\n  errorHtml: '<p class=\"text-danger mb-0\">Error loading content</p>',\n  sanitize: null,\n  fetch: null,\n  initTooltips: true,\n  tooltipOptions: { html: true },\n  bootstrap: null,\n  onInit: null,\n  onOpen: null,\n  onClose: null,\n  onLoadStart: null,\n  onLoadEnd: null,\n  onError: null,\n  onDestroy: null,\n};\n\nFxdDynamicModal.confirmDefaults = {\n  title: 'Confirm Action',\n  message: '',\n  confirmText: 'Confirm',\n  cancelText: 'Cancel',\n  confirmVariant: 'btn-danger',\n  cancelVariant: 'btn-outline-secondary',\n  confirmLoadingText: 'Working...',\n  size: 'sm',\n  bgClose: false,\n  showCloseBtn: true,\n  onConfirm: null,\n  onCancel: null,\n  onError: null,\n  confirmAction: null,\n};\n","export async function loadContent(url, fetchFn, signal) {\n  const response = await fetchFn(url, { signal });\n  if (!response.ok) {\n    const error = new Error(`Request failed with status ${response.status}`);\n    error.status = response.status;\n    error.response = response;\n    throw error;\n  }\n  return response.text();\n}"],"names":["dispatchEvent","el","name","detail","CustomEvent","bubbles","buildUrl","url","params","search","URLSearchParams","Object","entries","forEach","key","value","Array","isArray","item","append","String","set","toSearchParams","query","toString","includes","setContent","container","content","sanitizer","innerHTML","Node","node","cloneNode","appendChild","html","applyModalSettings","ui","settings","sizeClass","size","normalized","trim","startsWith","resolveSizeClass","classString","dialog","className","classList","add","extraModalClass","split","token","title","textContent","footer","style","display","showFooter","closeBtn","showCloseBtn","footerHtml","sanitize","FxdDynamicModal","constructor","options","this","defaults","state","open","loading","requestId","_ensureBootstrap","_mount","_bindBootstrapEvents","modalEl","modal","onInit","bs","bootstrap","window","Modal","Error","existing","document","getElementById","modalId","dialogEl","querySelector","titleEl","bodyEl","footerEl","closeBtnEl","createElement","id","tabIndex","setAttribute","titleId","contentId","header","dataset","fxdRole","type","body","okBtn","footerButtonText","loadingHtml","createModalTemplate","_onShown","onOpen","_onHidden","onClose","addEventListener","_ensureInstance","backdrop","bgClose","keyboard","Boolean","modalInstance","bsOptions","dispose","_startLoading","source","onLoadStart","_endLoading","onLoadEnd","_handleError","error","onError","errorHtml","setTitle","setFooter","overrideOptions","selectorSource","isSelectorSource","isElementSource","Element","HTMLElement","isRemoteSource","show","handleUpdate","abortController","abort","AbortController","fetchFn","fetch","async","signal","response","ok","status","text","loadContent","initTooltips","_disposeTooltips","_tooltips","root","bootstrapOverride","Tooltip","from","querySelectorAll","map","tooltipOptions","showConfirm","confirmOptions","confirmDefaults","_clearConfirmState","message","cancelBtn","cancelVariant","cancelText","confirmBtn","confirmVariant","confirmText","completed","onHidden","onCancel","onConfirmClick","event","preventDefault","originalText","disabled","confirmLoadingText","confirmAction","_executeConfirmAction","onConfirm","close","_confirmCleanup","removeEventListener","action","method","data","headers","toUpperCase","context","beforeResult","onBeforeSend","_submitConfirmForm","isGet","responseData","JSON","parse","onSuccess","onComplete","form","input","submit","remove","hide","length","tooltip","destroy","onDestroy","getState"],"mappings":"sPAAO,SAASA,EAAcC,EAAIC,EAAMC,EAAS,CAAA,GAC1CF,GACLA,EAAGD,cAAc,IAAII,YAAYF,EAAM,CAAEC,SAAQE,SAAS,IAC5D,CCaO,SAASC,EAASC,EAAKC,EAAS,IACrC,MAAMC,EAjBD,SAAwBD,EAAS,IACtC,MAAMC,EAAS,IAAIC,gBAYnB,OAXAC,OAAOC,QAAQJ,GAAQK,QAAQ,EAAEC,EAAKC,MAChCA,UACAC,MAAMC,QAAQF,GAChBA,EAAMF,QAASK,IACTA,SACJT,EAAOU,OAAOL,EAAKM,OAAOF,MAI9BT,EAAOY,IAAIP,EAAKM,OAAOL,OAElBN,CACT,CAGiBa,CAAed,GACxBe,EAAQd,EAAOe,WACrB,OAAKD,EACEhB,GAAOA,EAAIkB,SAAS,KAAO,IAAM,KAAOF,EAD5BhB,CAErB,CAEO,SAASmB,EAAWC,EAAWC,EAASC,EAAY,MACzD,IAAKF,EAAW,OAGhB,GAFAA,EAAUG,UAAY,GAEF,oBAATC,MAAwBH,aAAmBG,KAAM,CAC1D,MAAMC,EAAOJ,EAAQK,WAAU,GAE/B,YADAN,EAAUO,YAAYF,EAExB,CAEA,MAAMG,EAAkB,MAAXP,EAAkB,GAAKR,OAAOQ,GAC3CD,EAAUG,UAAiC,mBAAdD,EAA2BA,EAAUM,GAAQA,CAC5E,CCsCO,SAASC,EAAmBC,EAAIC,GACrC,MAAMC,EDnBD,SAA0BC,GAC/B,IAAKA,GAAiB,OAATA,EAAe,MAAO,GACnC,MAAMC,EAAarB,OAAOoB,GAAME,OAChC,OAAKD,EACDA,EAAWE,WAAW,UAAkBF,EACxCA,EAAWE,WAAW,eACtB,CAAC,KAAM,KAAM,KAAM,OAAOlB,SAASgB,GADS,SAASA,IAElDA,EAJiB,EAK1B,CCWoBG,CAAiBN,EAASE,MDTvC,IAAwBvC,EAAI4C,ECUjCR,EAAGS,OAAOC,UAAY,qCAClBR,GAAWF,EAAGS,OAAOE,UAAUC,IAAIV,GDXVtC,ECYdoC,EAAGS,ODZeD,ECYPP,EAASY,gBDX9BjD,GAAO4C,GACZA,EAAYM,MAAM,KAAKtC,QAASuC,IAC1BA,GAAOnD,EAAG+C,UAAUC,IAAIG,KCW9Bf,EAAGgB,MAAMC,YAAchB,EAASe,OAAS,GAEzChB,EAAGkB,OAAOC,MAAMC,QAAUnB,EAASoB,WAAa,OAAS,OACzDrB,EAAGsB,SAASH,MAAMC,QAAUnB,EAASsB,aAAe,eAAiB,OAEjEtB,EAASuB,YACXnC,EAAWW,EAAGkB,OAAQjB,EAASuB,WAAYvB,EAASwB,SAExD,CClFO,MAAMC,EACX,WAAAC,CAAYC,EAAU,IACpBC,KAAKD,QAAU,IAAKF,EAAgBI,YAAaF,GACjDC,KAAKE,MAAQ,CACXC,MAAM,EACNC,SAAS,EACTC,UAAW,GAGbL,KAAKM,mBACLN,KAAKO,SACLP,KAAKQ,uBAEL1E,EAAckE,KAAKS,QAAS,WAAY,CAAEC,MAAOV,OACjDA,KAAKD,QAAQY,SAASX,KACxB,CAEA,gBAAAM,GACE,MAAMM,EAAKZ,KAAKD,QAAQc,YAAgC,oBAAXC,OAAyBA,OAAOD,UAAY,MACzF,IAAKD,IAAOA,EAAGG,MACb,MAAM,IAAIC,MAAM,+DAElBhB,KAAKa,UAAYD,CACnB,CAEA,MAAAL,GACE,MAAMU,EAAWC,SAASC,eAAenB,KAAKD,QAAQqB,SAEtD,GAAIH,GAQF,GAPAjB,KAAKS,QAAUQ,EACfjB,KAAKqB,SAAWJ,EAASK,cAAc,iBACvCtB,KAAKuB,QAAUN,EAASK,cAAc,4BAA8BL,EAASK,cAAc,gBAC3FtB,KAAKwB,OAASP,EAASK,cAAc,8BAAgCL,EAASK,cAAc,eAC5FtB,KAAKyB,SAAWR,EAASK,cAAc,6BAA+BL,EAASK,cAAc,iBAC7FtB,KAAK0B,WAAaT,EAASK,cAAc,4BAA8BL,EAASK,cAAc,gBAEzFtB,KAAKqB,UAAarB,KAAKuB,SAAYvB,KAAKwB,QAAWxB,KAAKyB,UAAazB,KAAK0B,YAC7E,MAAM,IAAIV,MAAM,kFAEb,CACL,MAAM7C,ED3CL,SAA6BiD,EAASrB,GAC3C,MAAMW,EAAQQ,SAASS,cAAc,OACrCjB,EAAM7B,UAAY,aAClB6B,EAAMkB,GAAKR,EACXV,EAAMmB,UAAW,EACjBnB,EAAMoB,aAAa,cAAe,QAElC,MAAMC,EAAU,GAAGX,UACbY,EAAY,GAAGZ,YAErBV,EAAMoB,aAAa,kBAAmBC,GACtCrB,EAAMoB,aAAa,mBAAoBE,GAEvC,MAAMpD,EAASsC,SAASS,cAAc,OACtC/C,EAAOC,UAAY,qCAEnB,MAAMnB,EAAUwD,SAASS,cAAc,OACvCjE,EAAQmB,UAAY,gBAEpB,MAAMoD,EAASf,SAASS,cAAc,OACtCM,EAAOpD,UAAY,eAEnB,MAAMM,EAAQ+B,SAASS,cAAc,MACrCxC,EAAMN,UAAY,cAClBM,EAAMyC,GAAKG,EACX5C,EAAM+C,QAAQC,QAAU,QAExB,MAAM1C,EAAWyB,SAASS,cAAc,UACxClC,EAAS2C,KAAO,SAChB3C,EAASZ,UAAY,YACrBY,EAASqC,aAAa,kBAAmB,SACzCrC,EAASqC,aAAa,aAAc,SACpCrC,EAASyC,QAAQC,QAAU,QAE3BF,EAAOjE,YAAYmB,GACnB8C,EAAOjE,YAAYyB,GAEnB,MAAM4C,EAAOnB,SAASS,cAAc,OACpCU,EAAKxD,UAAY,aACjBwD,EAAKT,GAAKI,EACVK,EAAKH,QAAQC,QAAU,UAEvB,MAAM9C,EAAS6B,SAASS,cAAc,OACtCtC,EAAOR,UAAY,eACnBQ,EAAO6C,QAAQC,QAAU,SAEzB,MAAMG,EAAQpB,SAASS,cAAc,UAerC,OAdAW,EAAMF,KAAO,SACbE,EAAMzD,UAAY,oBAClByD,EAAMlD,YAAcW,EAAQwC,kBAAoB,KAChDD,EAAMR,aAAa,kBAAmB,SACtCzC,EAAOrB,YAAYsE,GAEnB5E,EAAQM,YAAYiE,GACpBvE,EAAQM,YAAYqE,GACpB3E,EAAQM,YAAYqB,GACpBT,EAAOZ,YAAYN,GACnBgD,EAAM1C,YAAYY,GAElBpB,EAAW6E,EAAMtC,EAAQyC,aAAe,IAEjC,CACL9B,QACA9B,SACAO,QACAkD,OACAhD,SACAI,WAEJ,CC1BiBgD,CAAoBzC,KAAKD,QAAQqB,QAASpB,KAAKD,SAC1DmB,SAASmB,KAAKrE,YAAYG,EAAGuC,OAC7BV,KAAKS,QAAUtC,EAAGuC,MAClBV,KAAKqB,SAAWlD,EAAGS,OACnBoB,KAAKuB,QAAUpD,EAAGgB,MAClBa,KAAKwB,OAASrD,EAAGkE,KACjBrC,KAAKyB,SAAWtD,EAAGkB,OACnBW,KAAK0B,WAAavD,EAAGsB,QACvB,CACF,CAEA,oBAAAe,GACER,KAAK0C,SAAW,KACd1C,KAAKE,MAAMC,MAAO,EAClBrE,EAAckE,KAAKS,QAAS,WAAY,CAAEC,MAAOV,OACjDA,KAAKD,QAAQ4C,SAAS3C,OAGxBA,KAAK4C,UAAY,KACf5C,KAAKE,MAAMC,MAAO,EAClBrE,EAAckE,KAAKS,QAAS,YAAa,CAAEC,MAAOV,OAClDA,KAAKD,QAAQ8C,UAAU7C,OAGzBA,KAAKS,QAAQqC,iBAAiB,iBAAkB9C,KAAK0C,UACrD1C,KAAKS,QAAQqC,iBAAiB,kBAAmB9C,KAAK4C,UACxD,CAEA,eAAAG,CAAgB3E,GACd,MAAM4E,IAAW5E,EAAS6E,SAAiB,SACrCC,EAAWC,QAAQ/E,EAAS6E,SAE7BjD,KAAKoD,eAAiBpD,KAAKqD,WAAWL,WAAaA,GAAYhD,KAAKqD,WAAWH,WAAaA,IAC/FlD,KAAKoD,eAAeE,UACpBtD,KAAKoD,cAAgB,IAAIpD,KAAKa,UAAUE,MAAMf,KAAKS,QAAS,CAAEuC,WAAUE,aACxElD,KAAKqD,UAAY,CAAEL,WAAUE,YAEjC,CAEA,aAAAK,CAAcC,GACZxD,KAAKE,MAAME,SAAU,EACrBtE,EAAckE,KAAKS,QAAS,gBAAiB,CAAEC,MAAOV,KAAMwD,WAC5DxD,KAAKD,QAAQ0D,cAAczD,KAAMwD,EACnC,CAEA,WAAAE,CAAYF,GACVxD,KAAKE,MAAME,SAAU,EACrBtE,EAAckE,KAAKS,QAAS,cAAe,CAAEC,MAAOV,KAAMwD,WAC1DxD,KAAKD,QAAQ4D,YAAY3D,KAAMwD,EACjC,CAEA,YAAAI,CAAaC,EAAOL,GAClBxD,KAAKE,MAAME,SAAU,EACrBtE,EAAckE,KAAKS,QAAS,YAAa,CAAEC,MAAOV,KAAMwD,SAAQK,UAChE7D,KAAKD,QAAQ+D,UAAUD,EAAO7D,KAAMwD,GAChCxD,KAAKD,QAAQgE,WACfvG,EAAWwC,KAAKwB,OAAQxB,KAAKD,QAAQgE,UAAW/D,KAAKD,QAAQH,SAEjE,CAEA,QAAAoE,CAAS7E,GACPa,KAAKuB,QAAQnC,YAAcD,GAAS,EACtC,CAEA,UAAA3B,CAAWE,GACTF,EAAWwC,KAAKwB,OAAQ9D,EAASsC,KAAKD,QAAQH,SAChD,CAEA,SAAAqE,CAAUvG,GACHsC,KAAKyB,UACVjE,EAAWwC,KAAKyB,SAAU/D,EAASsC,KAAKD,QAAQH,SAClD,CAEA,UAAMO,CAAKqD,EAAS,KAAMlH,EAAS,CAAA,EAAI4H,EAAkB,IACvD,MAAM9F,EAAW,IAAK4B,KAAKD,WAAYmE,GACjCC,EAAmC,iBAAXX,EAAsBA,EAAOhF,OAAS,GAC9D4F,EAAmBjB,QAAQgB,GAAkBA,EAAe1F,WAAW,MACvE4F,GFrFmBxH,EEqFY2G,EFpFhB,oBAAZc,UACJzH,aAAiByH,SAAWzH,aAAiB0H,cAF/C,IAAsB1H,EEsFzB,MAAM2H,EAAmC,iBAAXhB,IAAwBY,EAiBtD,GAfAlG,EACE,CACEU,OAAQoB,KAAKqB,SACblC,MAAOa,KAAKuB,QACZlC,OAAQW,KAAKyB,SACbhC,SAAUO,KAAK0B,YAEjBtD,GAGEoG,GAAkBpG,EAASoE,aAC7BhF,EAAWwC,KAAKwB,OAAQpD,EAASoE,YAAapE,EAASwB,UAGzDI,KAAK+C,gBAAgB3E,IAChBoF,EAEH,OADAxD,KAAKoD,cAAcqB,OACZ,KAGT,GAAIL,EAAkB,CACpB,MAAMrI,EAAKmF,SAASI,cAAc6C,GAClC,OAAKpI,GAKLiE,KAAKuD,cAAcC,GACnBhG,EAAWwC,KAAKwB,OAAQzF,EAAG6B,UAAWQ,EAASwB,UAC/CI,KAAK0D,YAAYF,GACjBxD,KAAKoD,cAAcqB,OACnBzE,KAAKoD,cAAcsB,iBACZ,OATL1E,KAAK4D,aAAa,IAAI5C,MAAM,qBAAsBwC,GAClDxD,KAAKoD,cAAcqB,OACZ,KAQX,CAEA,GAAIJ,EAMF,OALArE,KAAKuD,cAAcC,GACnBhG,EAAWwC,KAAKwB,OAAQgC,EAAQpF,EAASwB,UACzCI,KAAK0D,YAAYF,GACjBxD,KAAKoD,cAAcqB,OACnBzE,KAAKoD,cAAcsB,iBACZ,KAKT,GAFA1E,KAAKoD,cAAcqB,OAEfD,EAAgB,CAClB,MAAMnI,EAAMD,EAASoH,EAAQlH,GACvB+D,IAAcL,KAAKE,MAAMG,UAC3BL,KAAK2E,iBAAiB3E,KAAK2E,gBAAgBC,QAC/C5E,KAAK2E,gBAAkB,IAAIE,gBAE3B7E,KAAKuD,cAAclH,GAEnB,IACE,MAAMyI,EAAU1G,EAAS2G,OAASA,MAC5B9G,QCrLP+G,eAA2B3I,EAAKyI,EAASG,GAC9C,MAAMC,QAAiBJ,EAAQzI,EAAK,CAAE4I,WACtC,IAAKC,EAASC,GAAI,CAChB,MAAMtB,EAAQ,IAAI7C,MAAM,8BAA8BkE,EAASE,UAG/D,MAFAvB,EAAMuB,OAASF,EAASE,OACxBvB,EAAMqB,SAAWA,EACXrB,CACR,CACA,OAAOqB,EAASG,MAClB,CD4K2BC,CAAYjJ,EAAKyI,EAAS9E,KAAK2E,gBAAgBM,QAClE,GAAI5E,IAAcL,KAAKE,MAAMG,UAAW,OAAO,KAE/C7C,EAAWwC,KAAKwB,OAAQvD,EAAMG,EAASwB,UACvCI,KAAKoD,cAAcsB,iBACftG,EAASmH,eACXvF,KAAKwF,mBACLxF,KAAKyF,UFlJR,SAAsBC,EAAM3F,EAAU,CAAA,EAAI4F,EAAoB,MACnE,IAAKD,EAAM,OACX,GAAsB,oBAAX5E,OAAwB,OACnC,MAAMF,EAAK+E,GAAqB7E,OAAOD,UACvC,IAAKD,IAAOA,EAAGgF,QAAS,OAGxB,OADiB9I,MAAM+I,KAAKH,EAAKI,iBAAiB,+BAClCC,IAAKhK,GAEZ,IAAI6E,EAAGgF,QAAQ7J,EAAIgE,GAE9B,CEuI2BwF,CAAavF,KAAKwB,OAAQpD,EAAS4H,gBAAkB,CAAA,EAAIhG,KAAKa,YAAc,IAE/Fb,KAAK0D,YAAYrH,EACnB,CAAE,MAAOwH,GACP,GAAoB,eAAhBA,GAAO7H,KAAuB,OAAO,KACzCgE,KAAK4D,aAAaC,EAAOxH,EAC3B,CACA,OAAO,IACT,CAGA,OADA2D,KAAK4D,aAAa,IAAI5C,MAAM,2BAA4BwC,GACjD,IACT,CAEA,WAAAyC,CAAYC,EAAiB,IAC3B,MAAMnG,EAAU,IACXF,EAAgBsG,mBAChBD,GAEC9H,EAAW,IACZ4B,KAAKD,WACLA,EACHP,YAAY,EACZG,WAAY,MAGdK,KAAKoG,qBAELlI,EACE,CACEU,OAAQoB,KAAKqB,SACblC,MAAOa,KAAKuB,QACZlC,OAAQW,KAAKyB,SACbhC,SAAUO,KAAK0B,YAEjBtD,GAGFZ,EAAWwC,KAAKwB,OAAQzB,EAAQsG,SAAW,GAAIjI,EAASwB,UAExDI,KAAKyB,SAAS7D,UAAY,GAC1B,MAAM0I,EAAYpF,SAASS,cAAc,UACzC2E,EAAUlE,KAAO,SACjBkE,EAAUzH,UAAY,OAAOkB,EAAQwG,gBACrCD,EAAUlH,YAAcW,EAAQyG,WAChCF,EAAUxE,aAAa,kBAAmB,SAC1CwE,EAAUpE,QAAQC,QAAU,iBAE5B,MAAMsE,EAAavF,SAASS,cAAc,UAC1C8E,EAAWrE,KAAO,SAClBqE,EAAW5H,UAAY,OAAOkB,EAAQ2G,iBACtCD,EAAWrH,YAAcW,EAAQ4G,YACjCF,EAAWvE,QAAQC,QAAU,iBAE7BnC,KAAKyB,SAASzD,YAAYsI,GAC1BtG,KAAKyB,SAASzD,YAAYyI,GAE1B,IAAIG,GAAY,EAChB,MAAMC,EAAW,KACXD,IACJA,GAAY,EACZ5G,KAAKoG,qBACLrG,EAAQ+G,WAAW,CAAEpG,MAAOV,SAGxB+G,EAAiB/B,MAAOgC,IAE5B,GADAA,EAAMC,iBACFL,EAAW,OAEf,MAAMM,EAAeT,EAAWrH,YAChCqH,EAAWU,UAAW,EACtBb,EAAUa,UAAW,EACrBV,EAAWrH,YAAcW,EAAQqH,mBAEjC,IACMrH,EAAQsH,qBACJrH,KAAKsH,sBAAsBvH,EAAQsH,eAE3CtH,EAAQwH,YAAY,CAAE7G,MAAOV,OAC7B4G,GAAY,EACZ5G,KAAKoG,qBACLpG,KAAKwH,OACP,CAAE,MAAO3D,GACP9D,EAAQ+D,UAAUD,EAAO,CAAEnD,MAAOV,OAClCyG,EAAWU,UAAW,EACtBb,EAAUa,UAAW,EACrBV,EAAWrH,YAAc8H,CAC3B,GAeF,OAZAT,EAAW3D,iBAAiB,QAASiE,GACrC/G,KAAKS,QAAQqC,iBAAiB,kBAAmB+D,GAEjD7G,KAAKyH,gBAAkB,KACrBhB,EAAWiB,oBAAoB,QAASX,GACxC/G,KAAKS,QAAQiH,oBAAoB,kBAAmBb,GACpD7G,KAAKyH,gBAAkB,MAGzBzH,KAAK+C,gBAAgB3E,GACrB4B,KAAKoD,cAAcqB,OAEZzE,IACT,CAEA,kBAAAoG,GACEpG,KAAKyH,mBACP,CAEA,2BAAMH,CAAsBD,GAC1B,MAAMM,EAAS,CACbC,OAAQ,OACRC,KAAM,CAAA,EACN7C,OAAO,EACP8C,QAAS,CAAA,KACNT,GAECO,EAAS1K,OAAOyK,EAAOC,QAAU,QAAQG,cACzCC,EAAU,CAAEtH,MAAOV,KAAM2H,UAE/B,IAAKA,EAAOtL,IACV,MAAM,IAAI2E,MAAM,kCAGlB,MAAMiH,EAAeN,EAAOO,eAAeF,GAC3C,IAAqB,IAAjBC,EACF,MAAM,IAAIjH,MAAM,4CAGlB,IAAK2G,EAAO3C,MAEV,OADAhF,KAAKmI,mBAAmBR,EAAOtL,IAAKuL,EAAQD,EAAOE,MAC5C,KAGT,MAAM/C,EAAU6C,EAAO5C,OAAS/E,KAAKD,QAAQgF,OAASA,MAChDqD,EAAmB,QAAXR,EACRE,EAAU,IAAKH,EAAOG,SAC5B,IACIzF,EAgBA6C,EAjBA7I,EAAMsL,EAAOtL,IAGjB,GAAI+L,EACF/L,EAAMD,EAASC,EAAKsL,EAAOE,MAAQ,CAAA,OAC9B,CACL,MAAMtL,EAAS,IAAIC,gBACnBC,OAAOC,QAAQiL,EAAOE,MAAQ,CAAA,GAAIlL,QAAQ,EAAEC,EAAKC,MAC3CA,SACJN,EAAOU,OAAOL,EAAKM,OAAOL,MAE5BwF,EAAO9F,EAAOe,WACTwK,EAAQ,kBACXA,EAAQ,gBAAkB,mDAE9B,CAGA,IAAIO,EAAe,KAEnB,IACEnD,QAAiBJ,EAAQzI,EAAK,CAC5BuL,SACAE,UACAzF,SAGF,MAAMgD,QAAaH,EAASG,OAC5B,IACEgD,EAAeC,KAAKC,MAAMlD,EAC5B,CAAE,MACAgD,EAAehD,CACjB,CAEA,IAAKH,EAASC,GACZ,MAAM,IAAInE,MAAM,4CAA4CkE,EAASE,WAIvE,OADAuC,EAAOa,YAAYH,EAAcnD,EAAU8C,GACpCK,CACT,CAAE,MAAOxE,GAEP,MADA8D,EAAO7D,UAAUD,EAAOqB,EAAU8C,GAC5BnE,CACR,CAAC,QACC8D,EAAOc,aAAaT,EACtB,CACF,CAEA,kBAAAG,CAAmB9L,EAAKuL,EAAQC,EAAO,CAAA,GACrC,MAAMa,EAAOxH,SAASS,cAAc,QACpC+G,EAAKd,OAASA,EACdc,EAAKf,OAAStL,EACdqM,EAAKpJ,MAAMC,QAAU,OAErB9C,OAAOC,QAAQmL,GAAMlL,QAAQ,EAAEC,EAAKC,MAClC,GAAIA,QAAuC,OAE3C,GAAIC,MAAMC,QAAQF,GAShB,YARAA,EAAMF,QAASK,IACb,GAAIA,QAAqC,OACzC,MAAM2L,EAAQzH,SAASS,cAAc,SACrCgH,EAAMvG,KAAO,SACbuG,EAAM3M,KAAOY,EACb+L,EAAM9L,MAAQK,OAAOF,GACrB0L,EAAK1K,YAAY2K,KAKrB,MAAMA,EAAQzH,SAASS,cAAc,SACrCgH,EAAMvG,KAAO,SACbuG,EAAM3M,KAAOY,EACb+L,EAAM9L,MAAQK,OAAOL,GACrB6L,EAAK1K,YAAY2K,KAGnBzH,SAASmB,KAAKrE,YAAY0K,GAC1BA,EAAKE,SACLF,EAAKG,QACP,CAEA,KAAArB,GACExH,KAAKoD,eAAe0F,MACtB,CAEA,gBAAAtD,GACOxF,KAAKyF,WAAuC,IAA1BzF,KAAKyF,UAAUsD,SACtC/I,KAAKyF,UAAU9I,QAASqM,GAAYA,GAAS1F,aAC7CtD,KAAKyF,UAAY,GACnB,CAEA,OAAAwD,GACEjJ,KAAK2E,iBAAiBC,QACtB5E,KAAKwF,mBACLxF,KAAKoD,eAAeE,UACpBtD,KAAKS,QAAQiH,oBAAoB,iBAAkB1H,KAAK0C,UACxD1C,KAAKS,QAAQiH,oBAAoB,kBAAmB1H,KAAK4C,WACzD9G,EAAckE,KAAKS,QAAS,cAAe,CAAEC,MAAOV,OACpDA,KAAKD,QAAQmJ,YAAYlJ,MACzBA,KAAKS,QAAQoI,QACf,CAEA,QAAAM,GACE,MAAO,IAAKnJ,KAAKE,MACnB,EAGFL,EAAgBI,SAAW,CACzBmB,QAAS,kBACTjC,MAAO,cACPb,KAAM,KACNkB,YAAY,EACZyD,SAAS,EACTvD,cAAc,EACdV,gBAAiB,GACjBW,WAAY,KACZ4C,iBAAkB,KAClBC,YAAa,sKAIbuB,UAAW,wDACXnE,SAAU,KACVmF,MAAO,KACPQ,cAAc,EACdS,eAAgB,CAAE/H,MAAM,GACxB4C,UAAW,KACXF,OAAQ,KACRgC,OAAQ,KACRE,QAAS,KACTY,YAAa,KACbE,UAAW,KACXG,QAAS,KACToF,UAAW,MAGbrJ,EAAgBsG,gBAAkB,CAChChH,MAAO,iBACPkH,QAAS,GACTM,YAAa,UACbH,WAAY,SACZE,eAAgB,aAChBH,cAAe,wBACfa,mBAAoB,aACpB9I,KAAM,KACN2E,SAAS,EACTvD,cAAc,EACd6H,UAAW,KACXT,SAAU,KACVhD,QAAS,KACTuD,cAAe"}